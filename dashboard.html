<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Marine Environmental Monitoring</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep-ocean: #010A1C;
            --bg-mid-ocean: #0A192F;
            --accent-cyan: #00E5FF;
            --accent-green: #29FFC0;
            --accent-red: #FF4D6D;
            --accent-yellow: #FFD166;
            --text-primary: #E6F1FF;
            --text-secondary: #8892B0;
            --border-color: rgba(0, 229, 255, 0.2);
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background-color: var(--bg-deep-ocean);
            color: var(--text-primary);
            background: radial-gradient(ellipse at bottom, #011627 0%, #010A1C 100%);
            overflow-x: hidden;
        }

        .glass-card {
            background: rgba(10, 25, 47, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            border-color: rgba(0, 229, 255, 0.5);
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 229, 255, 0.1);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            box-shadow: 0 0 8px, 0 0 12px, 0 0 16px;
        }
        .status-dot.blue { background-color: var(--accent-cyan); box-shadow: 0 0 8px var(--accent-cyan), 0 0 12px var(--accent-cyan); }
        .status-dot.green { background-color: var(--accent-green); box-shadow: 0 0 8px var(--accent-green), 0 0 12px var(--accent-green); }
        .status-dot.red { background-color: var(--accent-red); box-shadow: 0 0 8px var(--accent-red), 0 0 12px var(--accent-red); }
        .status-dot.yellow { background-color: var(--accent-yellow); box-shadow: 0 0 8px var(--accent-yellow), 0 0 12px var(--accent-yellow); }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 5px var(--accent-red), 0 0 10px var(--accent-red); }
            50% { box-shadow: 0 0 15px var(--accent-red), 0 0 25px var(--accent-red); }
        }
        .pulse-live {
            animation: pulse-red 2s infinite;
        }
        
        .location-list-item.active {
             background: rgba(0, 229, 255, 0.1);
             border-left: 3px solid var(--accent-cyan);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep-ocean); }
        ::-webkit-scrollbar-thumb { background-color: var(--accent-cyan); border-radius: 10px; border: 2px solid var(--bg-deep-ocean); }
        ::-webkit-scrollbar-thumb:hover { background-color: #00b8d4; }

    </style>
</head>
<body class="p-4 lg:p-6">

    <div class="max-w-screen-2xl mx-auto">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-6">
            <div>
                <h1 class="text-3xl font-bold text-white">Marine Environmental Dashboard</h1>
                <p class="text-text-secondary" id="current-time">Loading time...</p>
            </div>
            <div class="flex items-center gap-3 mt-4 md:mt-0 glass-card p-3">
                <div class="relative flex h-3 w-3">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                </div>
                <span class="font-semibold text-red-400">LIVE FEED</span>
            </div>
        </header>

        <!-- Main Dashboard Grid -->
        <main class="grid grid-cols-1 lg:grid-cols-4 xl:grid-cols-6 gap-6">

            <!-- Left Column: Locations & Alerts -->
            <div class="lg:col-span-1 xl:col-span-1 flex flex-col gap-6">
                <div class="glass-card p-4 flex-grow">
                    <h2 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2">Monitoring Sites</h2>
                    <ul id="location-list" class="space-y-2 h-[250px] overflow-y-auto pr-2">
                        <!-- Location items will be injected here -->
                    </ul>
                </div>
                <div class="glass-card p-4">
                    <h2 class="text-xl font-semibold mb-4 text-accent-red">Critical Alerts</h2>
                    <ul id="alert-list" class="space-y-2 h-[150px] overflow-y-auto pr-2">
                       <li class="text-text-secondary">No critical alerts.</li>
                    </ul>
                </div>
            </div>

            <!-- Center Column: Key Metrics & Main Chart -->
            <div class="lg:col-span-3 xl:col-span-3 flex flex-col gap-6">
                 <!-- Key Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="glass-card p-4 text-center">
                        <p class="text-text-secondary">Temperature</p>
                        <p id="metric-temp" class="text-4xl font-bold">-- °C</p>
                    </div>
                    <div class="glass-card p-4 text-center">
                        <p class="text-text-secondary">pH Level</p>
                        <p id="metric-ph" class="text-4xl font-bold">--</p>
                    </div>
                    <div class="glass-card p-4 text-center">
                        <p class="text-text-secondary">Dissolved O₂</p>
                        <p id="metric-oxygen" class="text-4xl font-bold">-- mg/L</p>
                    </div>
                </div>
                <!-- Main Trend Chart -->
                <div class="glass-card p-4 h-[400px]">
                     <h2 id="main-chart-title" class="text-xl font-semibold mb-4">Real-time Parameter Trends</h2>
                     <canvas id="mainTrendChart"></canvas>
                </div>
            </div>

            <!-- Right Column: Details & Taxonomy -->
            <div class="lg:col-span-4 xl:col-span-2 flex flex-col gap-6">
                <div class="glass-card p-4">
                    <h2 class="text-xl font-semibold mb-4">Zone Distribution</h2>
                    <div class="h-[180px] flex items-center justify-center">
                        <canvas id="zoneDistributionChart"></canvas>
                    </div>
                </div>
                 <div class="glass-card p-4 flex-grow">
                    <h2 id="details-title" class="text-xl font-semibold mb-4">Salinity Comparison</h2>
                     <div class="h-[250px]">
                        <canvas id="salinityBarChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Blog Section -->
            <div class="lg:col-span-4 xl:col-span-6 mt-6">
                <div class="glass-card p-4">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-white">Research & Field Notes</h2>
                        <input type="text" id="blog-search" placeholder="Search articles..." class="mt-4 md:mt-0 w-full md:w-1/3 bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-accent-cyan transition">
                    </div>
                    <div id="blog-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 max-h-[500px] overflow-y-auto p-2">
                        <!-- Blog posts will be generated here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DATA (Converted from your CSVs) ---
    const environmentalData = [
        { location: "Visakhapatnam", dateTime: "2025-09-14 12:00:00", temp: 27.5, ph: 8.1, oxygen: 6.2, salinity: 34.8, chlorophyll: 0.9, turbidity: 1.2, status: "Blue" },
        { location: "Kochi", dateTime: "2025-09-14 12:00:00", temp: 29.1, ph: 7.9, oxygen: 4.8, salinity: 33.5, chlorophyll: 1.4, turbidity: 1.5, status: "Green" },
        { location: "Bay of Bengal", dateTime: "2025-09-14 12:00:00", temp: 28.2, ph: 8.2, oxygen: 5.5, salinity: 34.2, chlorophyll: 0.7, turbidity: 1, status: "Blue" },
        { location: "Arabian Sea", dateTime: "2025-09-14 12:00:00", temp: 28.8, ph: 8.0, oxygen: 5.1, salinity: 35.5, chlorophyll: 1.2, turbidity: 1.4, status: "Green" },
        { location: "Indian Ocean", dateTime: "2025-09-14 12:00:00", temp: 27.9, ph: 8.3, oxygen: 6.0, salinity: 35.1, chlorophyll: 0.6, turbidity: 0.9, status: "Blue" },
        { location: "Laccadive Sea", dateTime: "2025-09-15 06:00:00", temp: 29.5, ph: 8.2, oxygen: 5.8, salinity: 34.9, chlorophyll: 0.8, turbidity: 1.1, status: "Blue" },
        { location: "Andaman Sea", dateTime: "2025-09-15 06:00:00", temp: 28.6, ph: 8.1, oxygen: 5.3, salinity: 33.8, chlorophyll: 1.3, turbidity: 1.6, status: "Green" },
        { location: "Gulf of Kutch", dateTime: "2025-09-15 12:00:00", temp: 29.8, ph: 7.8, oxygen: 4.5, salinity: 36.2, chlorophyll: 1.8, turbidity: 2.1, status: "Yellow" },
        { location: "Gulf of Khambhat", dateTime: "2025-09-15 18:00:00", temp: 28.4, ph: 7.9, oxygen: 4.7, salinity: 35.8, chlorophyll: 2.2, turbidity: 2.8, status: "Yellow" },
        { location: "Palk Strait", dateTime: "2025-09-15 18:00:00", temp: 29.2, ph: 8.0, oxygen: 5.6, salinity: 34.5, chlorophyll: 1.1, turbidity: 1.3, status: "Blue" },
        { location: "Strait of Malacca", dateTime: "2025-09-16 06:00:00", temp: 29.0, ph: 7.9, oxygen: 5.0, salinity: 33.2, chlorophyll: 1.5, turbidity: 1.8, status: "Green" },
        { location: "Hussain Sagar", dateTime: "2025-09-16 09:00:00", temp: 29, ph: 7.15, oxygen: 2, salinity: 1, chlorophyll: 22, turbidity: 28.5, status: "Red" }
    ];

    const taxonomyData = {
        "Visakhapatnam": ["Mackerel", "Sardines", "Tuna", "Olive Ridley Turtles", "Dolphins"],
        "Kochi": ["Shrimp", "Tuna", "Mackerel", "Sea Cucumbers", "Mud Crabs"],
        "Bay of Bengal": ["Hilsa Fish", "Sardines", "Anchovies", "Sea Turtles", "Dolphins"],
        "Arabian Sea": ["Kingfish", "Pomfret", "Tuna", "Coral Reef Species", "Sharks"],
        "Indian Ocean": ["Red Snapper", "Grouper", "Tuna", "Whale Sharks", "Manta Rays"],
        "Laccadive Sea": ["Mahi Mahi", "Barracuda", "Reef Fish", "Corals", "Sea Turtles"],
        "Andaman Sea": ["Tuna", "Mahi Mahi", "Coral Reef Species", "Clownfish", "Giant Clams"],
        "Gulf of Kutch": ["Indian Mackerel", "Pomfret", "Bombay Duck", "Mangrove Species", "Crabs"],
        "Gulf of Khambhat": ["Rohu", "Kingfish", "Indian Salmon", "Estuarine Species", "Mudskippers"],
        "Palk Strait": ["Sardine", "Indian Anchovy", "Sea Cucumber", "Dugongs", "Seagrass"],
        "Strait of Malacca": ["Red Snapper", "Grouper", "Barracuda", "Commercial Fish Stocks"],
        "Hussain Sagar": ["Pollution-tolerant fish", "Algae", "Bacteria"]
    };

    const blogPosts = [
        { id: 1, title: "Healthy Ecosystem Flourishes in Visakhapatnam", content: "Our latest readings from Visakhapatnam show a thriving marine environment. With optimal oxygen levels and balanced pH, the region supports a diverse range of species, including mackerel and sea turtles.", date: "2025-09-22", location: "Visakhapatnam", tags: ["Blue Zone", "Biodiversity", "Healthy"] },
        { id: 2, title: "Cautionary Signs in Kochi's Backwaters", content: "Slightly decreased oxygen levels in Kochi have moved the area into a 'Green' status. While still stable, this indicates a need for ongoing monitoring to prevent further decline.", date: "2025-09-22", location: "Kochi", tags: ["Green Zone", "Monitoring", "Estuary"] },
        { id: 3, title: "The Expansive Health of the Bay of Bengal", content: "The Bay of Bengal continues to be a bastion of marine health. Consistent 'Blue' readings suggest a stable and resilient ecosystem, crucial for the Hilsa fish population.", date: "2025-09-21", location: "Bay of Bengal", tags: ["Blue Zone", "Fisheries", "Resilience"] },
        { id: 4, title: "Arabian Sea: A Hub for Coral Reef Research", content: "The 'Green' status of the Arabian Sea provides a perfect environment for studying its unique coral reef species. Salinity and temperature levels are ideal for coral growth.", date: "2025-09-21", location: "Arabian Sea", tags: ["Green Zone", "Coral Reefs", "Research"] },
        { id: 5, title: "Indian Ocean's Blue Zone: A Whale Shark Haven", content: "Pristine conditions in the Indian Ocean are confirmed with our latest data. This 'Blue' zone is a critical habitat for large migratory species like whale sharks.", date: "2025-09-20", location: "Indian Ocean", tags: ["Blue Zone", "Megafauna", "Conservation"] },
        { id: 6, title: "Laccadive Sea's Coral Gardens Thriving", content: "Excellent water quality in the Laccadive Sea supports its vibrant coral gardens. Our data confirms a 'Blue' status, essential for both corals and the reef fish that depend on them.", date: "2025-09-20", location: "Laccadive Sea", tags: ["Blue Zone", "Coral Reefs", "Biodiversity"] },
        { id: 7, title: "Andaman Sea: Monitoring Clownfish Habitats", content: "The delicate habitats of clownfish and giant clams in the Andaman Sea are currently stable, though a 'Green' status warrants careful observation of pH levels.", date: "2025-09-19", location: "Andaman Sea", tags: ["Green Zone", "Iconic Species", "Monitoring"] },
        { id: 8, title: "High Turbidity in Gulf of Kutch: A Yellow Flag", content: "Increased turbidity and chlorophyll levels have resulted in a 'Yellow' alert for the Gulf of Kutch. This could impact the local mangrove species and fisheries.", date: "2025-09-19", location: "Gulf of Kutch", tags: ["Yellow Zone", "Turbidity", "Mangroves"] },
        { id: 9, title: "Nutrient Overload in Gulf of Khambhat", content: "The Gulf of Khambhat is also under a 'Yellow' status due to high chlorophyll content, suggesting a nutrient overload that may affect estuarine species.", date: "2025-09-18", location: "Gulf of Khambhat", tags: ["Yellow Zone", "Eutrophication", "Estuary"] },
        { id: 10, title: "Palk Strait's Seagrass Meadows Stable", content: "The vital seagrass meadows of the Palk Strait, home to dugongs, are in a healthy 'Blue' zone. Water clarity and salinity are within optimal ranges.", date: "2025-09-18", location: "Palk Strait", tags: ["Blue Zone", "Seagrass", "Conservation"] },
        { id: 11, title: "Commercial Fisheries in Strait of Malacca Under Watch", content: "A 'Green' status in the Strait of Malacca calls for observation of its important commercial fish stocks. Oxygen levels are stable but close to cautionary thresholds.", date: "2025-09-17", location: "Strait of Malacca", tags: ["Green Zone", "Fisheries", "Economy"] },
        { id: 12, title: "CRITICAL ALERT: Hussain Sagar Oxygen Levels Plummet", content: "Urgent action is needed in Hussain Sagar. Oxygen has dropped to critical levels, resulting in a 'Red' alert. This poses a severe threat to all aquatic life.", date: "2025-09-17", location: "Hussain Sagar", tags: ["Red Zone", "Pollution", "Critical"] },
        { id: 13, title: "The Importance of Salinity Gradients", content: "Our data highlights significant salinity differences between marine and inland sites. These gradients are crucial for defining species distribution and habitat zones.", date: "2025-09-16", location: "General", tags: ["Salinity", "Research", "Habitats"] },
        { id: 14, title: "Using Chlorophyll Data to Predict Algal Blooms", content: "Monitoring chlorophyll-a levels, as seen in the Gulf of Khambhat, is a key method for predicting harmful algal blooms before they occur, protecting local ecosystems.", date: "2025-09-15", location: "General", tags: ["Algal Blooms", "Prediction", "Technology"] },
        { id: 15, title: "Field Notes: The Link Between Turbidity and Biodiversity", content: "A comparative analysis of our sites shows a clear inverse correlation between turbidity and species richness. Clearer waters like the Laccadive Sea boast higher biodiversity.", date: "2025-09-14", location: "General", tags: ["Turbidity", "Biodiversity", "Analysis"] }
    ];

    let selectedLocation = environmentalData[0].location;
    let mainChart;
    let zoneChart;
    let salinityChart;

    // --- INITIALIZATION ---
    function init() {
        updateTime();
        setInterval(updateTime, 1000);
        
        populateLocationList();
        setupCharts();
        populateBlogs();
        
        updateDashboard(selectedLocation);

        // Simulate live data feed
        setInterval(simulateDataUpdate, 3000);

        document.getElementById('blog-search').addEventListener('input', (e) => {
            populateBlogs(e.target.value);
        });
    }

    // --- UI UPDATE FUNCTIONS ---

    function updateTime() {
        const now = new Date();
        document.getElementById('current-time').textContent = now.toLocaleString();
    }

    function populateLocationList() {
        const list = document.getElementById('location-list');
        list.innerHTML = '';
        environmentalData.forEach(data => {
            const item = document.createElement('li');
            item.className = `location-list-item p-2 rounded-md cursor-pointer flex justify-between items-center transition-all duration-200 ${data.location === selectedLocation ? 'active' : ''}`;
            item.dataset.location = data.location;
            item.innerHTML = `
                <span>${data.location}</span>
                <span class="status-dot ${data.status.toLowerCase()}"></span>
            `;
            item.addEventListener('click', () => {
                selectedLocation = data.location;
                document.querySelectorAll('.location-list-item').forEach(li => li.classList.remove('active'));
                item.classList.add('active');
                updateDashboard(selectedLocation);
            });
            list.appendChild(item);
        });
    }

    function updateDashboard(location) {
        const data = environmentalData.find(d => d.location === location);
        if (!data) return;

        // Update key metrics
        document.getElementById('metric-temp').textContent = `${data.temp.toFixed(1)} °C`;
        document.getElementById('metric-ph').textContent = data.ph.toFixed(2);
        document.getElementById('metric-oxygen').textContent = `${data.oxygen.toFixed(1)} mg/L`;
        
        // Update main chart title
        document.getElementById('main-chart-title').textContent = `Real-time Parameter Trends: ${location}`;
    }
    
    function updateAlerts() {
        const alertList = document.getElementById('alert-list');
        const criticalAlerts = environmentalData.filter(d => d.status === 'Red');
        if (criticalAlerts.length > 0) {
            alertList.innerHTML = criticalAlerts.map(alert => 
                `<li class="flex items-center gap-2 p-2 bg-red-500/10 rounded-md">
                    <span class="status-dot red"></span>
                    <div>
                        <p class="font-bold">${alert.location}</p>
                        <p class="text-xs text-text-secondary">Critical environmental levels detected.</p>
                    </div>
                </li>`
            ).join('');
        } else {
            alertList.innerHTML = '<li class="text-text-secondary">No critical alerts.</li>';
        }
    }

    function populateBlogs(searchTerm = '') {
        const container = document.getElementById('blog-container');
        container.innerHTML = '';
        const filteredPosts = blogPosts.filter(post => 
            post.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
            post.content.toLowerCase().includes(searchTerm.toLowerCase()) ||
            post.tags.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()))
        );

        if (filteredPosts.length === 0) {
            container.innerHTML = `<p class="text-text-secondary col-span-full text-center">No articles found.</p>`;
            return;
        }

        filteredPosts.forEach(post => {
            const card = document.createElement('div');
            card.className = 'glass-card p-4 flex flex-col justify-between';
            card.innerHTML = `
                <div>
                    <h3 class="font-bold text-lg text-accent-cyan">${post.title}</h3>
                    <p class="text-sm text-text-secondary my-2">${post.date} - ${post.location}</p>
                    <p class="text-sm text-text-primary mb-3">${post.content}</p>
                </div>
                <div class="flex flex-wrap gap-2">
                    ${post.tags.map(tag => `<span class="text-xs bg-gray-700 text-gray-300 px-2 py-1 rounded-full">${tag}</span>`).join('')}
                </div>
            `;
            container.appendChild(card);
        });
    }

    // --- CHARTING ---
    function setupCharts() {
        Chart.defaults.color = 'rgba(230, 241, 255, 0.7)';
        Chart.defaults.borderColor = 'rgba(0, 229, 255, 0.1)';

        // Main Trend Chart
        const ctxMain = document.getElementById('mainTrendChart').getContext('2d');
        mainChart = new Chart(ctxMain, {
            type: 'line',
            data: {
                datasets: [
                    { label: 'Temperature (°C)', data: [], borderColor: 'rgba(255, 77, 109, 1)', tension: 0.4, yAxisID: 'y' },
                    { label: 'pH', data: [], borderColor: 'rgba(41, 255, 192, 1)', tension: 0.4, yAxisID: 'y1' },
                    { label: 'Oxygen (mg/L)', data: [], borderColor: 'rgba(0, 229, 255, 1)', tension: 0.4, yAxisID: 'y2' }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: {
                    x: { type: 'time', time: { unit: 'second' }, grid: { display: false } },
                    y: { position: 'left', beginAtZero: false, title: { display: true, text: 'Temp (°C)' }, suggestedMin: 25, suggestedMax: 32 },
                    y1: { position: 'right', beginAtZero: false, title: { display: true, text: 'pH' }, grid: { drawOnChartArea: false }, suggestedMin: 7, suggestedMax: 9 },
                    y2: { position: 'right', beginAtZero: false, title: { display: true, text: 'O₂ (mg/L)' }, grid: { drawOnChartArea: false }, suggestedMin: 0, suggestedMax: 8 }
                },
                plugins: { legend: { position: 'bottom' } }
            }
        });

        // Zone Distribution Chart
        const ctxZone = document.getElementById('zoneDistributionChart').getContext('2d');
        const zoneCounts = environmentalData.reduce((acc, curr) => {
            acc[curr.status] = (acc[curr.status] || 0) + 1;
            return acc;
        }, {});
        
        const statusColors = {
            "Blue": 'rgba(0, 229, 255, 0.7)',
            "Green": 'rgba(41, 255, 192, 0.7)',
            "Yellow": 'rgba(255, 209, 102, 0.7)',
            "Red": 'rgba(255, 77, 109, 0.7)'
        };

        const chartLabels = Object.keys(zoneCounts);
        
        zoneChart = new Chart(ctxZone, {
            type: 'doughnut',
            data: {
                labels: chartLabels,
                datasets: [{
                    data: Object.values(zoneCounts),
                    backgroundColor: chartLabels.map(label => statusColors[label] || '#8892B0'), // Use map to ensure correct color
                    borderColor: 'rgba(10, 25, 47, 0.8)',
                    borderWidth: 2,
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: true, position: 'right' } }
            }
        });

        // Salinity Bar Chart
        const ctxSalinity = document.getElementById('salinityBarChart').getContext('2d');
        const salinityData = environmentalData.slice(0, 6); // Display first 6 for clarity
        salinityChart = new Chart(ctxSalinity, {
            type: 'bar',
            data: {
                labels: salinityData.map(d => d.location),
                datasets: [{
                    label: 'Salinity (ppt)',
                    data: salinityData.map(d => d.salinity),
                    backgroundColor: 'rgba(0, 229, 255, 0.5)',
                    borderColor: 'rgba(0, 229, 255, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { beginAtZero: true }
                },
                plugins: { legend: { display: false } }
            }
        });
    }

    function updateMainChart(location) {
        const data = environmentalData.find(d => d.location === location);
        if (!data) return;
        
        const now = new Date();
        const maxDataPoints = 20;

        mainChart.data.datasets.forEach((dataset, index) => {
            if(dataset.data.length >= maxDataPoints) {
                dataset.data.shift();
            }
            let value;
            if(index === 0) value = data.temp;
            if(index === 1) value = data.ph;
            if(index === 2) value = data.oxygen;
            dataset.data.push({ x: now.getTime(), y: value });
        });
        
        mainChart.update('quiet');
    }
    
     function updateZoneChart() {
        const zoneCounts = environmentalData.reduce((acc, curr) => {
            acc[curr.status] = (acc[curr.status] || 0) + 1;
            return acc;
        }, {});
        const newLabels = Object.keys(zoneCounts);
        zoneChart.data.labels = newLabels;
        zoneChart.data.datasets[0].data = Object.values(zoneCounts);
        // This is the crucial fix: Recalculate colors on every update
        zoneChart.data.datasets[0].backgroundColor = newLabels.map(label => statusColors[label] || '#8892B0');
        zoneChart.update();
    }


    // --- DATA SIMULATION ---
    function simulateDataUpdate() {
        let statusChanged = false;
        environmentalData.forEach(data => {
            // Fluctuate values slightly
            data.temp += (Math.random() - 0.5) * 0.2;
            data.ph += (Math.random() - 0.5) * 0.05;
            data.oxygen += (Math.random() - 0.5) * 0.1;
            
            // Simple logic to potentially change status for demonstration
            const oldStatus = data.status;
            if(data.oxygen < 3 && data.location === "Hussain Sagar") data.status = "Red";
            else if (data.oxygen < 5 && data.status !== "Red") data.status = "Green";
            else if (data.oxygen > 6 && data.status !== "Red") data.status = "Blue";
            
            if(oldStatus !== data.status) {
                statusChanged = true;
            }
        });

        // Update UI only if the currently selected location's data changed
        updateDashboard(selectedLocation);
        updateMainChart(selectedLocation);

        if(statusChanged) {
             populateLocationList();
             updateAlerts();
             updateZoneChart();
        }
    }

    init();
});
</script>

</body>
</html>



